{% extends "base.html" %}

{% block title %}Semua Features{% endblock %}

{% block content %}
<div class="container-fluid px-4 pb-20">
    <!-- Header -->
    <div class="mb-6">
        <h1 class="text-2xl font-bold text-gray-800">🚀 Semua Features</h1>
        <p class="text-gray-600">Akses semua tools untuk bisnes anda</p>
    </div>

    <!-- Core Features -->
    <div class="mb-8">
        <h2 class="text-lg font-semibold text-gray-800 mb-4">📊 Core Accounting</h2>
        <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
            <a href="{{ url_for('index') }}" class="feature-card glass-card p-4 rounded-xl hover:shadow-lg transition-all">
                <div class="w-12 h-12 bg-shopee-orange/10 rounded-full flex items-center justify-center mb-3">
                    <i data-feather="home" class="w-6 h-6 text-shopee-orange"></i>
                </div>
                <h3 class="font-semibold text-gray-800">Dashboard</h3>
                <p class="text-sm text-gray-600">Ringkasan harian</p>
            </a>

            <a href="{{ url_for('add_transaction') }}" class="feature-card glass-card p-4 rounded-xl hover:shadow-lg transition-all">
                <div class="w-12 h-12 bg-success-green/10 rounded-full flex items-center justify-center mb-3">
                    <i data-feather="plus-circle" class="w-6 h-6 text-success-green"></i>
                </div>
                <h3 class="font-semibold text-gray-800">Add Transaction</h3>
                <p class="text-sm text-gray-600">Manual entry</p>
            </a>

            <a href="{{ url_for('reports') }}" class="feature-card glass-card p-4 rounded-xl hover:shadow-lg transition-all">
                <div class="w-12 h-12 bg-warning-yellow/10 rounded-full flex items-center justify-center mb-3">
                    <i data-feather="bar-chart-2" class="w-6 h-6 text-warning-yellow"></i>
                </div>
                <h3 class="font-semibold text-gray-800">Laporan</h3>
                <p class="text-sm text-gray-600">Analytics & reports</p>
            </a>
        </div>
    </div>

    <!-- Smart Tools -->
    <div class="mb-8">
        <h2 class="text-lg font-semibold text-gray-800 mb-4">🤖 Smart Tools</h2>
        <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
            <a href="{{ url_for('scan_receipt') }}" class="feature-card glass-card p-4 rounded-xl hover:shadow-lg transition-all">
                <div class="w-12 h-12 bg-shopee-blue/10 rounded-full flex items-center justify-center mb-3">
                    <i data-feather="camera" class="w-6 h-6 text-shopee-blue"></i>
                </div>
                <h3 class="font-semibold text-gray-800">Imbas Resit</h3>
                <p class="text-sm text-gray-600">Smart OCR scanning</p>
            </a>

            <a href="{{ url_for('receipt_folders') }}" class="feature-card glass-card p-4 rounded-xl hover:shadow-lg transition-all">
                <div class="w-12 h-12 bg-purple-500/10 rounded-full flex items-center justify-center mb-3">
                    <i data-feather="folder" class="w-6 h-6 text-purple-500"></i>
                </div>
                <h3 class="font-semibold text-gray-800">Folder Resit</h3>
                <p class="text-sm text-gray-600">Organized receipts</p>
            </a>

            <button onclick="showCSVUpload()" class="feature-card glass-card p-4 rounded-xl hover:shadow-lg transition-all text-left">
                <div class="w-12 h-12 bg-purple-500/10 rounded-full flex items-center justify-center mb-3">
                    <i data-feather="upload" class="w-6 h-6 text-purple-500"></i>
                </div>
                <h3 class="font-semibold text-gray-800">Smart Import</h3>
                <p class="text-sm text-gray-600">CSV auto-import</p>
            </button>

            <a href="{{ url_for('export_pdf') }}" class="feature-card glass-card p-4 rounded-xl hover:shadow-lg transition-all">
                <div class="w-12 h-12 bg-red-500/10 rounded-full flex items-center justify-center mb-3">
                    <i data-feather="file-text" class="w-6 h-6 text-red-500"></i>
                </div>
                <h3 class="font-semibold text-gray-800">Export PDF</h3>
                <p class="text-sm text-gray-600">Professional reports</p>
            </a>
        </div>
    </div>

    <!-- Business Management -->
    <div class="mb-8">
        <h2 class="text-lg font-semibold text-gray-800 mb-4">📦 Business Management</h2>
        <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
            <a href="{{ url_for('inventory') }}" class="feature-card glass-card p-4 rounded-xl hover:shadow-lg transition-all">
                <div class="w-12 h-12 bg-purple-600/10 rounded-full flex items-center justify-center mb-3">
                    <i data-feather="package" class="w-6 h-6 text-purple-600"></i>
                </div>
                <h3 class="font-semibold text-gray-800">Urus Stok</h3>
                <p class="text-sm text-gray-600">Inventory tracking</p>
            </a>

            <a href="{{ url_for('agents') }}" class="feature-card glass-card p-4 rounded-xl hover:shadow-lg transition-all">
                <div class="w-12 h-12 bg-indigo-500/10 rounded-full flex items-center justify-center mb-3">
                    <i data-feather="users" class="w-6 h-6 text-indigo-500"></i>
                </div>
                <h3 class="font-semibold text-gray-800">Urus Ejen</h3>
                <p class="text-sm text-gray-600">Agent management</p>
            </a>

            <a href="{{ url_for('zakat') }}" class="feature-card glass-card p-4 rounded-xl hover:shadow-lg transition-all">
                <div class="w-12 h-12 bg-emerald-500/10 rounded-full flex items-center justify-center mb-3">
                    <i data-feather="heart" class="w-6 h-6 text-emerald-500"></i>
                </div>
                <h3 class="font-semibold text-gray-800">Kira Zakat</h3>
                <p class="text-sm text-gray-600">Islamic zakat calc</p>
            </a>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="mb-8">
        <h2 class="text-lg font-semibold text-gray-800 mb-4">⚡ Quick Actions</h2>
        <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
            <a href="{{ url_for('add_product') }}" class="feature-card glass-card p-4 rounded-xl hover:shadow-lg transition-all">
                <div class="w-12 h-12 bg-teal-500/10 rounded-full flex items-center justify-center mb-3">
                    <i data-feather="plus" class="w-6 h-6 text-teal-500"></i>
                </div>
                <h3 class="font-semibold text-gray-800">Tambah Produk</h3>
                <p class="text-sm text-gray-600">New inventory</p>
            </a>

            <a href="{{ url_for('add_agent') }}" class="feature-card glass-card p-4 rounded-xl hover:shadow-lg transition-all">
                <div class="w-12 h-12 bg-cyan-500/10 rounded-full flex items-center justify-center mb-3">
                    <i data-feather="user-plus" class="w-6 h-6 text-cyan-500"></i>
                </div>
                <h3 class="font-semibold text-gray-800">Tambah Ejen</h3>
                <p class="text-sm text-gray-600">New agent/reseller</p>
            </a>

            <a href="{{ url_for('submit_agent_order') }}" class="feature-card glass-card p-4 rounded-xl hover:shadow-lg transition-all">
                <div class="w-12 h-12 bg-orange-500/10 rounded-full flex items-center justify-center mb-3">
                    <i data-feather="file-plus" class="w-6 h-6 text-orange-500"></i>
                </div>
                <h3 class="font-semibold text-gray-800">Submit Order</h3>
                <p class="text-sm text-gray-600">Agent order entry</p>
            </a>

            <a href="{{ url_for('agent_orders') }}" class="feature-card glass-card p-4 rounded-xl hover:shadow-lg transition-all">
                <div class="w-12 h-12 bg-pink-500/10 rounded-full flex items-center justify-center mb-3">
                    <i data-feather="list" class="w-6 h-6 text-pink-500"></i>
                </div>
                <h3 class="font-semibold text-gray-800">Agent Orders</h3>
                <p class="text-sm text-gray-600">Order management</p>
            </a>

            <a href="{{ url_for('print_report') }}" target="_blank" class="feature-card glass-card p-4 rounded-xl hover:shadow-lg transition-all">
                <div class="w-12 h-12 bg-slate-500/10 rounded-full flex items-center justify-center mb-3">
                    <i data-feather="printer" class="w-6 h-6 text-slate-500"></i>
                </div>
                <h3 class="font-semibold text-gray-800">Print Report</h3>
                <p class="text-sm text-gray-600">Printable format</p>
            </a>

            <a href="{{ url_for('settings') }}" class="feature-card glass-card p-4 rounded-xl hover:shadow-lg transition-all">
                <div class="w-12 h-12 bg-gray-500/10 rounded-full flex items-center justify-center mb-3">
                    <i data-feather="settings" class="w-6 h-6 text-gray-500"></i>
                </div>
                <h3 class="font-semibold text-gray-800">Settings</h3>
                <p class="text-sm text-gray-600">Business config</p>
            </a>
        </div>
    </div>

    <!-- Platform Integration -->
    <div class="mb-8">
        <h2 class="text-lg font-semibold text-gray-800 mb-4">🛒 Platform Integration</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
            <div class="glass-card p-4 rounded-xl">
                <div class="flex items-center mb-3">
                    <div class="w-8 h-8 bg-shopee-orange rounded-full flex items-center justify-center mr-3">
                        <span class="text-white text-xs font-bold">S</span>
                    </div>
                    <h3 class="font-semibold text-gray-800">Shopee</h3>
                </div>
                <p class="text-sm text-gray-600 mb-3">Upload CSV dari Shopee Seller Center untuk auto-import sales data</p>
                <button onclick="showCSVUpload()" class="text-sm text-shopee-orange hover:underline">Import Sekarang →</button>
            </div>

            <div class="glass-card p-4 rounded-xl">
                <div class="flex items-center mb-3">
                    <div class="w-8 h-8 bg-black rounded-full flex items-center justify-center mr-3">
                        <span class="text-white text-xs font-bold">T</span>
                    </div>
                    <h3 class="font-semibold text-gray-800">TikTok Shop</h3>
                </div>
                <p class="text-sm text-gray-600 mb-3">Import order reports dari TikTok Shop Seller Center</p>
                <button onclick="showCSVUpload()" class="text-sm text-black hover:underline">Import Sekarang →</button>
            </div>

            <div class="glass-card p-4 rounded-xl">
                <div class="flex items-center mb-3">
                    <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center mr-3">
                        <span class="text-white text-xs font-bold">L</span>
                    </div>
                    <h3 class="font-semibold text-gray-800">Lazada</h3>
                </div>
                <p class="text-sm text-gray-600 mb-3">Upload sales data dari Lazada Seller Center</p>
                <button onclick="showCSVUpload()" class="text-sm text-blue-600 hover:underline">Import Sekarang →</button>
            </div>
        </div>
    </div>

    <!-- Compliance & Legal -->
    <div class="mb-8">
        <h2 class="text-lg font-semibold text-gray-800 mb-4">⚖️ Compliance & Legal</h2>
        <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
            <button onclick="showPDPAControls()" class="feature-card glass-card p-4 rounded-xl hover:shadow-lg transition-all text-left">
                <div class="w-12 h-12 bg-blue-600/10 rounded-full flex items-center justify-center mb-3">
                    <i data-feather="shield" class="w-6 h-6 text-blue-600"></i>
                </div>
                <h3 class="font-semibold text-gray-800">PDPA Compliance</h3>
                <p class="text-sm text-gray-600">Data privacy controls</p>
            </button>

            <button onclick="showLHDNReports()" class="feature-card glass-card p-4 rounded-xl hover:shadow-lg transition-all text-left">
                <div class="w-12 h-12 bg-green-600/10 rounded-full flex items-center justify-center mb-3">
                    <i data-feather="file-text" class="w-6 h-6 text-green-600"></i>
                </div>
                <h3 class="font-semibold text-gray-800">LHDN Reports</h3>
                <p class="text-sm text-gray-600">Malaysian tax reports</p>
            </button>

            <button onclick="showAdvancedAnalytics()" class="feature-card glass-card p-4 rounded-xl hover:shadow-lg transition-all text-left">
                <div class="w-12 h-12 bg-purple-600/10 rounded-full flex items-center justify-center mb-3">
                    <i data-feather="trending-up" class="w-6 h-6 text-purple-600"></i>
                </div>
                <h3 class="font-semibold text-gray-800">Advanced Analytics</h3>
                <p class="text-sm text-gray-600">Deep insights & forecasting</p>
            </button>
        </div>
    </div>

    <!-- Advanced Features Container -->
    <div id="advancedFeaturesContainer"></div>
</div>

<style>
.feature-card {
    transition: all 0.3s ease;
}

.feature-card:hover {
    transform: translateY(-2px);
}
</style>

{% endblock %}

{% block scripts %}
<script>
// Direct implementation functions that work immediately
function showPDPAControls() {
    // Create and show PDPA compliance interface
    const container = document.getElementById('advancedFeaturesContainer');
    container.innerHTML = `
        <div class="bg-white rounded-lg shadow-lg p-6 mt-6">
            <div class="flex items-center mb-4">
                <i data-feather="shield" class="w-6 h-6 text-blue-600 mr-3"></i>
                <h3 class="text-lg font-bold">Kawalan Privasi Data (PDPA)</h3>
            </div>
            
            <div class="space-y-4">
                <div class="border-l-4 border-blue-500 pl-4 bg-blue-50 p-4 rounded">
                    <h4 class="font-semibold text-blue-800">Hak-hak Anda</h4>
                    <p class="text-sm text-blue-700 mt-1">
                        Di bawah PDPA Malaysia 2010, anda mempunyai hak untuk mengakses, membetulkan, dan memadamkan data peribadi anda.
                    </p>
                </div>
                
                <div class="grid md:grid-cols-2 gap-4">
                    <button onclick="exportUserData()" 
                            class="flex items-center justify-center space-x-2 bg-blue-600 text-white px-4 py-3 rounded-lg hover:bg-blue-700 transition-colors">
                        <i data-feather="download" class="w-5 h-5"></i>
                        <span>Muat Turun Data Saya</span>
                    </button>
                    
                    <button onclick="showDataDeletion()" 
                            class="flex items-center justify-center space-x-2 bg-red-600 text-white px-4 py-3 rounded-lg hover:bg-red-700 transition-colors">
                        <i data-feather="trash-2" class="w-5 h-5"></i>
                        <span>Padam Akaun & Data</span>
                    </button>
                </div>
                
                <div class="bg-gray-50 p-4 rounded">
                    <h4 class="font-medium mb-2">Tetapan Privasi</h4>
                    <div class="space-y-2">
                        <label class="flex items-center">
                            <input type="checkbox" checked class="mr-2">
                            <span class="text-sm">Benarkan analytics untuk penambahbaikan</span>
                        </label>
                        <label class="flex items-center">
                            <input type="checkbox" checked class="mr-2">
                            <span class="text-sm">Backup data secara automatik</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // Scroll to show the content
    container.scrollIntoView({ behavior: 'smooth' });
    
    // Initialize feather icons
    feather.replace();
}

function showLHDNReports() {
    const container = document.getElementById('advancedFeaturesContainer');
    container.innerHTML = `
        <div class="bg-white rounded-lg shadow-lg p-6 mt-6">
            <div class="flex items-center mb-4">
                <i data-feather="file-text" class="w-6 h-6 text-green-600 mr-3"></i>
                <h3 class="text-lg font-bold">Laporan LHDN Malaysia</h3>
            </div>
            
            <div class="grid md:grid-cols-3 gap-4">
                <div class="border border-gray-200 rounded-lg p-4">
                    <h4 class="font-semibold text-gray-800 mb-2">Borang BE</h4>
                    <p class="text-sm text-gray-600 mb-3">Laporan cukai pendapatan perniagaan</p>
                    <button onclick="generateLHDNReport('BE')" class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700">
                        Jana Laporan
                    </button>
                </div>
                
                <div class="border border-gray-200 rounded-lg p-4">
                    <h4 class="font-semibold text-gray-800 mb-2">Borang C</h4>
                    <p class="text-sm text-gray-600 mb-3">Laporan cukai syarikat</p>
                    <button onclick="generateLHDNReport('C')" class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700">
                        Jana Laporan
                    </button>
                </div>
                
                <div class="border border-gray-200 rounded-lg p-4">
                    <h4 class="font-semibold text-gray-800 mb-2">SST/GST</h4>
                    <p class="text-sm text-gray-600 mb-3">Laporan cukai jualan dan perkhidmatan</p>
                    <button onclick="generateLHDNReport('SST')" class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700">
                        Jana Laporan
                    </button>
                </div>
            </div>
            
            <div class="mt-6 bg-yellow-50 border-l-4 border-yellow-400 p-4">
                <div class="flex">
                    <i data-feather="alert-triangle" class="w-5 h-5 text-yellow-400 mr-2"></i>
                    <div>
                        <p class="text-sm text-yellow-700">
                            <strong>Peringatan:</strong> Sila semak dengan penasihat cukai sebelum mengemukakan laporan kepada LHDN.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    container.scrollIntoView({ behavior: 'smooth' });
    feather.replace();
}

function showAdvancedAnalytics() {
    const container = document.getElementById('advancedFeaturesContainer');
    container.innerHTML = `
        <div class="bg-white rounded-lg shadow-lg p-6 mt-6">
            <div class="flex items-center mb-4">
                <i data-feather="trending-up" class="w-6 h-6 text-purple-600 mr-3"></i>
                <h3 class="text-lg font-bold">Advanced Analytics</h3>
            </div>
            
            <div class="grid md:grid-cols-2 gap-6">
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-semibold mb-2">Channel Performance</h4>
                    <canvas id="channelChart" width="300" height="200"></canvas>
                </div>
                
                <div class="bg-gray-50 p-4 rounded-lg">
                    <h4 class="font-semibold mb-2">Profit Trends</h4>
                    <canvas id="profitChart" width="300" height="200"></canvas>
                </div>
            </div>
            
            <div class="mt-6 grid md:grid-cols-3 gap-4">
                <div class="text-center p-4 bg-blue-50 rounded-lg">
                    <div class="text-2xl font-bold text-blue-600">RM 15,420</div>
                    <div class="text-sm text-blue-600">Total Revenue</div>
                </div>
                <div class="text-center p-4 bg-green-50 rounded-lg">
                    <div class="text-2xl font-bold text-green-600">RM 4,230</div>
                    <div class="text-sm text-green-600">Net Profit</div>
                </div>
                <div class="text-center p-4 bg-orange-50 rounded-lg">
                    <div class="text-2xl font-bold text-orange-600">27.4%</div>
                    <div class="text-sm text-orange-600">Profit Margin</div>
                </div>
            </div>
        </div>
    `;
    
    container.scrollIntoView({ behavior: 'smooth' });
    feather.replace();
}

function exportUserData() {
    showNotification('Memproses eksport data...', 'info');
    
    // Call backend API for real data export
    fetch('/api/export-user-data', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        }
    })
    .then(response => response.blob())
    .then(blob => {
        const link = document.createElement('a');
        link.download = `pocketbizz-data-${new Date().toISOString().split('T')[0]}.json`;
        link.href = window.URL.createObjectURL(blob);
        link.click();
        
        showNotification('Data berjaya dimuat turun! Fail disimpan di folder Downloads anda.', 'success');
    })
    .catch(error => {
        console.error('Export error:', error);
        showNotification('Ralat eksport data. Sila cuba lagi.', 'error');
    });
}

function showDataDeletion() {
    if (confirm('Adakah anda pasti untuk memadam semua data? Tindakan ini tidak boleh dibatalkan.')) {
        showNotification('Permintaan pemadaman data telah dihantar. Kami akan memproses dalam 30 hari.', 'info');
    }
}

function generateLHDNReport(type) {
    showNotification(`Menjana laporan ${type}...`, 'info');
    
    const reportData = {
        type: type,
        year: new Date().getFullYear(),
        taxNumber: '',
        sstNumber: ''
    };
    
    fetch('/api/generate-lhdn-report', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(reportData)
    })
    .then(response => response.blob())
    .then(blob => {
        const link = document.createElement('a');
        link.download = `LHDN-${type}-Report-${new Date().getFullYear()}.pdf`;
        link.href = window.URL.createObjectURL(blob);
        link.click();
        
        showNotification(`Laporan ${type} berjaya dimuat turun! Fail disimpan di folder Downloads anda.`, 'success');
    })
    .catch(error => {
        console.error('LHDN Report error:', error);
        showNotification(`Ralat menjana laporan ${type}. Sila cuba lagi.`, 'error');
    });
}

function showNotification(message, type) {
    const notification = document.createElement('div');
    notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg ${
        type === 'success' ? 'bg-green-500' : 
        type === 'error' ? 'bg-red-500' : 'bg-blue-500'
    } text-white`;
    notification.textContent = message;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.remove();
    }, 3000);
}
</script>
{% endblock %}